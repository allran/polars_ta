# Point In Time

本质上是因发现历史数据有问题，需要进行修改而产生的。我们使用的行情数据其实也会有修改需求。所以是否能将其一起讨论呢？

1. 行情数据：date\asset\features\[update_time]
2. 财务数据：date\asset\features\update_time

date表示报告期、update_time表示更新时间

行情数据中，date其本质就是报告期，又因更新时间等于报告期，所以被省略了，同股票date一般也不会重复，如有重复，必有update_time字段做区分，否则数据有误。

行情数据有两种修改方法

1. 直接修改原数据
2. 仿财务数据，只添加不修改。（其实财务数据发布后在第二天交易开始前发生了修改可以只保留一条最新记录）
    - 按日分文件存储，记录是添加到最后一个文件中，还是添加到那天的文件呢？
    - 即，存储时是保证date有序还是保证update_time有序

## PIT数据的处理

1. 数据更新时间可能是周末。但理想方式是与行情一样处理，所以date需要移动到周五,update_time保持真实时间
2. PIT处理分三步，第一步过滤出对应时间的DF、第二步在每个DF上分别计算各时序指标（也可不算），第三步取每个DF中最新部分进行合并

不能在第三步后再执行时序计算了，因为这会引入未来数据