# Point In Time

本质上是因发现历史数据有问题，需要进行修改而产生的。我们使用的行情数据其实也会有修改需求。所以是否能将其一起讨论呢？

1. 行情数据：date\asset\features\[update_time]
2. 财务数据：date\asset\features\update_time

date表示报告期、update_time表示公布日期

## 财务数据的更新

1. 按报告期date下载，只要指定每年的4个报告期即可下载。但新记录中如果改了历史报告期。而用户又无法知道是哪个报告期，得全下
2. 按公布日update_time下载，能完美的解决上面的问题。但公布日不固定、节假日也会发生，按日下载又效率低，所以得按时间段下载

## 财务数据的存储

由于已经选定用update_time来下载数据，所以存储时也按update_time来分文件名，这样也方便读取和更新

## 行情数据的更新与存储

行情数据中，date其本质就是报告期，又因更新时间等于报告期，所以被省略了，同股票date一般也不会重复，如有重复，必有update_time字段做区分，否则数据有误。

行情数据有两种修改方法:

1. 仿财务数据，只添加不修改。（其实财务数据发布后在第二天交易开始前发生了更新可以直接修改）
    - 按日分文件存储，记录是添加到最后一个文件中，还是添加到那天的文件呢？
    - 因为存储是按update_time有序，所以应当添加到最后
2. 直接修改原数据。在行情数据由于一般省略了update_time，所以更新方式也更多是覆盖

## PIT数据的处理

1. 数据更新时间可能是周末。但理想方式是与行情一样处理，所以date需要移动到周五,update_time保持真实时间
2. PIT处理分三步，第一步过滤出对应时间的DF、第二步在每个DF上分别计算各时序指标（也可不算），第三步取每个DF中最新部分进行合并

不能在第三步后再执行时序计算了，因为这会引入未来数据